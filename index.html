<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flatlander Simulator</title>
  </head>
  <body>
    <header class="app-bar">
      <button id="sidebar-toggle-btn" type="button" class="sidebar-toggle" aria-label="Toggle menu">☰</button>
      <div class="app-bar-title">Flatlander</div>
      <div class="app-bar-right">
        <button id="quick-run-btn" type="button" class="quick-run-btn">Start</button>
        <div id="app-version-badge" class="app-version-badge">v0.0.0</div>
      </div>
    </header>
    <div id="mobile-menu-backdrop" class="mobile-menu-backdrop" aria-hidden="true"></div>
    <div class="app-shell" id="app-shell">
      <aside class="sidebar" id="sidebar">
        <h1>Flatlander</h1>

        <section class="panel">
          <h2>Simulation</h2>
          <div class="row">
            <label for="seed-input">Seed</label>
            <input id="seed-input" type="number" value="42" step="1" />
          </div>
          <div class="row">
            <label for="world-topology">Topology</label>
            <select id="world-topology">
              <option value="torus" selected>Torus (Wrap)</option>
              <option value="bounded">Bounded (Walls)</option>
            </select>
          </div>
          <div class="row">
            <label for="speed-select">Speed</label>
            <select id="speed-select">
              <option value="0.5">0.5x</option>
              <option value="1" selected>1x</option>
              <option value="1.5">1.5x</option>
              <option value="2">2x</option>
            </select>
          </div>
          <div class="row">
            <label for="south-enabled">South Attraction</label>
            <input id="south-enabled" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="south-strength">Strength</label>
            <input id="south-strength" type="number" min="0" step="0.1" value="2" />
          </div>
          <div class="row">
            <label for="south-women-multiplier">Women Multiplier</label>
            <input id="south-women-multiplier" type="number" min="0" step="0.1" value="2" />
          </div>
          <div class="row">
            <label for="south-zone-start">Zone Start</label>
            <input id="south-zone-start" type="number" min="0" max="1" step="0.01" value="0.75" />
          </div>
          <div class="row">
            <label for="south-zone-end">Zone End</label>
            <input id="south-zone-end" type="number" min="0" max="1" step="0.01" value="0.95" />
          </div>
          <div class="row">
            <label for="south-drag">Drag</label>
            <input id="south-drag" type="number" min="0" step="0.1" value="12" />
          </div>
          <div class="row">
            <label for="south-max-terminal">Max Terminal</label>
            <input id="south-max-terminal" type="number" min="0" step="0.1" value="1.8" />
          </div>
          <div class="row">
            <label for="south-escape-fraction">Escape Fraction</label>
            <input id="south-escape-fraction" type="number" min="0" max="1" step="0.05" value="0.5" />
          </div>
          <div class="row">
            <label for="south-show-zone">Show South Zone</label>
            <input id="south-show-zone" type="checkbox" />
          </div>
          <div class="row">
            <label for="south-show-click-debug">Show Click Debug</label>
            <input id="south-show-click-debug" type="checkbox" />
          </div>
          <div class="button-row">
            <button id="run-btn" type="button">Start</button>
            <button id="step-btn" type="button">Step 1 Tick</button>
            <button id="reset-btn" type="button">Reset</button>
          </div>
          <div class="button-row" style="margin-top: 6px">
            <button id="novel-safety-preset-btn" type="button">Novel Safety Preset</button>
            <button id="harmonic-motion-preset-btn" type="button">Harmonic Motion Preset</button>
          </div>
        </section>

        <section class="panel">
          <h2>Event Highlights</h2>
          <div class="row">
            <label for="event-highlights-enabled">Enabled</label>
            <input id="event-highlights-enabled" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="event-highlights-show-legend">Show Legend</label>
            <input id="event-highlights-show-legend" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="event-highlights-intensity">Intensity</label>
            <input id="event-highlights-intensity" type="number" min="0" max="3" step="0.1" value="1" />
          </div>
          <div class="row">
            <label for="event-highlights-cap">Cap / Tick</label>
            <input id="event-highlights-cap" type="number" min="1" step="1" value="120" />
          </div>
          <div class="row">
            <label for="event-show-feeling">Show Feeling</label>
            <input id="event-show-feeling" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="event-focus-selected">Focus On Selected</label>
            <input id="event-focus-selected" type="checkbox" />
          </div>
          <div class="row">
            <label for="event-show-hearing">Show Hearing Overlay</label>
            <input id="event-show-hearing" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="event-show-talking">Show Talking Overlay</label>
            <input id="event-show-talking" type="checkbox" />
          </div>
          <div class="row">
            <label for="event-stroke-kills">Stroke By Kills</label>
            <input id="event-stroke-kills" type="checkbox" />
          </div>
          <div class="row">
            <label for="overlay-contact-network">Contact Network</label>
            <input id="overlay-contact-network" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="overlay-network-parents">Network Parents</label>
            <input id="overlay-network-parents" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="overlay-network-known">Network Known</label>
            <input id="overlay-network-known" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="overlay-network-max-known">Max Known Edges</label>
            <input id="overlay-network-max-known" type="number" min="0" max="200" step="1" value="25" />
          </div>
          <div class="row">
            <label for="overlay-network-on-screen">Only On Screen</label>
            <input id="overlay-network-on-screen" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="overlay-network-focus-radius">Focus Radius</label>
            <input id="overlay-network-focus-radius" type="number" min="0" step="1" value="400" />
          </div>
          <div class="row">
            <label for="overlay-dim-age">Dim By Age</label>
            <input id="overlay-dim-age" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="overlay-dim-deterioration">Dim By Deterioration</label>
            <input id="overlay-dim-deterioration" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="overlay-dim-strength">Dimming Strength</label>
            <input id="overlay-dim-strength" type="number" min="0" max="1" step="0.05" value="0.55" />
          </div>
          <div class="row">
            <label for="overlay-fog-preview">Fog Preview (Selected)</label>
            <input id="overlay-fog-preview" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="overlay-fog-preview-strength">Fog Preview Strength</label>
            <input id="overlay-fog-preview-strength" type="number" min="0" max="1" step="0.05" value="0.5" />
          </div>
          <div class="row">
            <label for="overlay-fog-preview-hide-min">Hide Below Fog Min</label>
            <input id="overlay-fog-preview-hide-min" type="checkbox" />
          </div>
          <div class="row">
            <label for="overlay-fog-rings">Show Fog Rings</label>
            <input id="overlay-fog-rings" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="overlay-show-eyes">Show Eyes</label>
            <input id="overlay-show-eyes" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="overlay-show-pov-cone">Show POV Cone (Selected)</label>
            <input id="overlay-show-pov-cone" type="checkbox" />
          </div>
          <p class="hint">Network links: parent=curved solid, known=curved dotted.</p>
          <p class="hint">Kill stroke legend: 0 / 1-2 / 3-5 / 6+</p>
          <div class="button-row">
            <button id="event-highlights-clear" type="button">Clear Effects</button>
          </div>
        </section>

        <section class="panel">
          <h2>Flatlander View</h2>
          <div class="row">
            <label for="flatlander-enabled">Enabled</label>
            <input id="flatlander-enabled" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="flatlander-rays">Rays</label>
            <select id="flatlander-rays">
              <option value="360">360</option>
              <option value="720" selected>720</option>
              <option value="1024">1024</option>
            </select>
          </div>
          <div class="row">
            <label for="flatlander-fov">FOV</label>
            <select id="flatlander-fov">
              <option value="180" selected>180°</option>
              <option value="360">360°</option>
            </select>
          </div>
          <div class="row">
            <label for="flatlander-look-offset">Look Offset (°)</label>
            <input id="flatlander-look-offset" type="range" min="-180" max="180" step="1" value="0" />
          </div>
          <div class="row">
            <label for="flatlander-max-distance">Max Distance</label>
            <input id="flatlander-max-distance" type="number" min="1" step="1" value="400" />
          </div>
          <div class="row">
            <label for="flatlander-fog-density">Fog Scale</label>
            <input id="flatlander-fog-density" type="number" min="0" step="0.001" value="0.012" />
          </div>
          <div class="row">
            <label for="flatlander-include-obstacles">Include Obstacles</label>
            <input id="flatlander-include-obstacles" type="checkbox" checked />
          </div>
          <p class="hint">Display appears in the stage below the world view.</p>
        </section>

        <section class="panel">
          <h2>Fog / Sight</h2>
          <div class="row">
            <label for="fog-sight-enabled">Sight Enabled</label>
            <input id="fog-sight-enabled" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="fog-sight-density">Fog Density</label>
            <input id="fog-sight-density" type="number" min="0" step="0.001" value="0.012" />
          </div>
          <p class="hint">Fog=0 keeps presence sight, but removes dimness-based distance cues.</p>
        </section>

        <section class="panel" id="legend-panel">
          <h2>Legend</h2>
          <ul class="legend-list" id="legend-list"></ul>
          <p class="hint" id="legend-empty-hint">Legend updates from active overlays and observed events.</p>
        </section>

        <section class="panel">
          <h2>World / Environment</h2>
          <div class="row">
            <label for="env-houses-enabled">Houses Enabled</label>
            <input id="env-houses-enabled" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="env-house-count">House Count</label>
            <input id="env-house-count" type="number" min="0" max="40" step="1" value="8" />
          </div>
          <div class="row">
            <label for="env-town-population">Town Population</label>
            <input id="env-town-population" type="number" min="0" step="100" value="5000" />
          </div>
          <div class="row">
            <label for="env-allow-triangular-forts">Allow Triangular Forts</label>
            <input id="env-allow-triangular-forts" type="checkbox" />
          </div>
          <div class="row">
            <label for="env-allow-square-houses">Allow Square Houses</label>
            <input id="env-allow-square-houses" type="checkbox" />
          </div>
          <div class="row">
            <label for="env-house-size">House Size</label>
            <input id="env-house-size" type="number" min="4" max="120" step="1" value="30" />
          </div>
          <div class="row">
            <label for="env-rain-enabled">Rain Enabled</label>
            <input id="env-rain-enabled" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="env-show-rain-overlay">Show Rain Overlay</label>
            <input id="env-show-rain-overlay" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="env-show-fog-overlay">Show Fog Overlay</label>
            <input id="env-show-fog-overlay" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="env-show-house-doors">Show House Doors</label>
            <input id="env-show-house-doors" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="env-show-house-occupancy">Show Occupancy</label>
            <input id="env-show-house-occupancy" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="env-show-housing-debug">Show Housing Debug</label>
            <input id="env-show-housing-debug" type="checkbox" />
          </div>
          <div class="row">
            <label for="peace-cry-enabled">Peace-Cry Enabled</label>
            <input id="peace-cry-enabled" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="peace-cry-cadence">Peace-Cry Cadence</label>
            <input id="peace-cry-cadence" type="number" min="1" step="1" value="20" />
          </div>
          <div class="row">
            <label for="peace-cry-radius">Peace-Cry Radius</label>
            <input id="peace-cry-radius" type="number" min="0" step="1" value="120" />
          </div>
          <div class="button-row">
            <button id="peace-cry-apply-all" type="button">Apply Cry To Women</button>
          </div>
          <p class="hint">House generation follows current settings on Reset. Peace-cry defaults apply fully after Reset.</p>
        </section>

        <section class="panel">
          <h2>Reproduction</h2>
          <div class="row">
            <label for="reproduction-enabled">Enabled</label>
            <input id="reproduction-enabled" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="reproduction-gestation-ticks">Gestation Ticks</label>
            <input id="reproduction-gestation-ticks" type="number" min="1" step="1" value="130" />
          </div>
          <div class="row">
            <label for="reproduction-mating-radius">Mating Radius</label>
            <input id="reproduction-mating-radius" type="number" min="0" step="1" value="52" />
          </div>
          <div class="row">
            <label for="reproduction-conception-chance">Conception / Tick</label>
            <input id="reproduction-conception-chance" type="number" min="0" max="1" step="0.0001" value="0.02" />
          </div>
          <div class="row">
            <label for="reproduction-female-birth-probability">Female Birth Prob.</label>
            <input id="reproduction-female-birth-probability" type="number" min="0" max="1" step="0.01" value="0.52" />
          </div>
          <div class="row">
            <label for="reproduction-max-population">Max Population</label>
            <input id="reproduction-max-population" type="number" min="1" step="1" value="650" />
          </div>
          <div class="row">
            <label for="reproduction-irregular-enabled">Irregular Births</label>
            <input id="reproduction-irregular-enabled" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="reproduction-irregular-base-chance">Irregular Base Chance</label>
            <input
              id="reproduction-irregular-base-chance"
              type="number"
              min="0"
              max="1"
              step="0.0001"
              value="0.14"
            />
          </div>
          <p class="hint">Reset preserves current reproduction settings.</p>
        </section>

        <section class="panel">
          <h2>Spawn</h2>
          <div class="row">
            <label for="spawn-shape">Shape</label>
            <select id="spawn-shape">
              <option value="segment">Woman (Segment)</option>
              <option value="polygon" selected>Man (Polygon)</option>
              <option value="circle">Priest (Circle)</option>
            </select>
          </div>
          <div class="row" id="spawn-sides-row">
            <label for="spawn-sides">Sides</label>
            <input id="spawn-sides" type="number" min="3" max="20" step="1" value="6" />
          </div>
          <div class="row" id="spawn-irregular-row">
            <label for="spawn-irregular">Irregular</label>
            <input id="spawn-irregular" type="checkbox" />
          </div>
          <div class="row" id="spawn-triangle-kind-row">
            <label for="spawn-triangle-kind">Triangle Kind</label>
            <select id="spawn-triangle-kind">
              <option value="Equilateral" selected>Equilateral</option>
              <option value="Isosceles">Isosceles</option>
            </select>
          </div>
          <div class="row" id="spawn-base-ratio-row">
            <label for="spawn-base-ratio">Base Ratio</label>
            <input id="spawn-base-ratio" type="number" min="0.01" max="0.95" step="0.01" value="0.05" />
          </div>
          <div class="row" id="spawn-mimicry-row">
            <label for="spawn-mimicry-enabled">Voice Imposture</label>
            <input id="spawn-mimicry-enabled" type="checkbox" />
          </div>
          <div class="row" id="spawn-mimicry-signature-row">
            <label for="spawn-mimicry-signature">Claimed Voice</label>
            <select id="spawn-mimicry-signature">
              <option value="Square" selected>Square</option>
              <option value="Pentagon">Pentagon</option>
              <option value="HighOrder">High Order</option>
            </select>
          </div>
          <div class="row">
            <label for="spawn-size">Size</label>
            <input id="spawn-size" type="number" min="2" max="120" value="20" />
          </div>
          <div class="row" id="spawn-female-rank-row">
            <label for="spawn-female-rank">Female Rank</label>
            <select id="spawn-female-rank">
              <option value="Low">Low</option>
              <option value="Middle" selected>Middle</option>
              <option value="High">High</option>
            </select>
          </div>
          <div class="row">
            <label for="spawn-count">Count</label>
            <input id="spawn-count" type="number" min="1" max="200" value="1" />
          </div>
          <div class="row">
            <label for="spawn-movement-type">Behavior</label>
            <select id="spawn-movement-type">
              <option value="socialNav" selected>Social Nav</option>
              <option value="randomWalk">Random Walk</option>
              <option value="straightDrift">Straight Drift</option>
              <option value="seekPoint">Seek Point</option>
            </select>
          </div>
          <div class="row">
            <label for="spawn-boundary">Boundary</label>
            <select id="spawn-boundary" disabled>
              <option value="wrap" selected>Wrap Torus</option>
              <option value="bounce">Bounded Walls</option>
            </select>
          </div>
          <p class="hint">Boundary is controlled by World Topology.</p>
          <div class="row" id="spawn-speed-row">
            <label for="spawn-speed">Speed</label>
            <input id="spawn-speed" type="number" step="0.1" value="25" />
          </div>
          <div class="row" id="spawn-turn-rate-row">
            <label for="spawn-turn-rate">Turn Rate</label>
            <input id="spawn-turn-rate" type="number" step="0.1" value="2" />
          </div>
          <div class="row" id="spawn-social-decision-row">
            <label for="spawn-decision-ticks">Decision Every Ticks</label>
            <input id="spawn-decision-ticks" type="number" min="1" step="1" value="18" />
          </div>
          <div class="row" id="spawn-social-intention-row">
            <label for="spawn-intention-min-ticks">Intention Min Ticks</label>
            <input id="spawn-intention-min-ticks" type="number" min="1" step="1" value="80" />
          </div>
          <div class="row" id="spawn-drift-row">
            <label for="spawn-vx">Velocity</label>
            <div class="pair-input">
              <input id="spawn-vx" type="number" step="0.1" value="40" />
              <input id="spawn-vy" type="number" step="0.1" value="0" />
            </div>
          </div>
          <div class="row" id="spawn-target-row">
            <label for="spawn-target-x">Target</label>
            <div class="pair-input">
              <input id="spawn-target-x" type="number" step="0.1" value="500" />
              <input id="spawn-target-y" type="number" step="0.1" value="350" />
            </div>
          </div>
          <div class="row">
            <label for="spawn-feeling-enabled">Feeling Enabled</label>
            <input id="spawn-feeling-enabled" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="spawn-feel-cooldown">Feel Cooldown</label>
            <input id="spawn-feel-cooldown" type="number" min="0" step="1" value="30" />
          </div>
          <div class="row">
            <label for="spawn-approach-speed">Approach Speed</label>
            <input id="spawn-approach-speed" type="number" min="0" step="0.1" value="10" />
          </div>
          <div class="button-row">
            <button id="spawn-btn" type="button">Spawn</button>
          </div>
        </section>

        <section class="panel">
          <h2>Inspector</h2>
          <div class="row"><span>Selected</span><strong id="selected-id">None</strong></div>
          <div class="row"><span>Name</span><strong id="selected-name">N/A</strong></div>
          <div class="row"><span>Rank</span><strong id="inspector-rank">N/A</strong></div>
          <div class="row"><span>Job</span><strong id="inspector-job">N/A</strong></div>
          <div class="row"><span>Shape</span><strong id="inspector-shape">N/A</strong></div>
          <div class="row"><span>Kills</span><strong id="inspector-kills">0</strong></div>
          <div id="inspector-house-summary" hidden>
            <div class="row"><span>House Kind</span><strong id="inspector-house-kind">N/A</strong></div>
            <div class="row"><span>Occupants</span><strong id="inspector-house-occupant-total">0</strong></div>
            <div class="row"><span>Occupants List</span></div>
            <ul id="inspector-house-occupants" class="rank-list"></ul>
          </div>
          <p id="inspector-none" class="hint">Click a figure to edit movement.</p>
          <div id="inspector-fields">
            <div class="row" id="inspector-dwelling-row">
              <span>Dwelling</span>
              <div>
                <strong id="inspector-dwelling-state">outside</strong>
                <span> | house: </span>
                <strong id="inspector-dwelling-house">N/A</strong>
                <span> | ticks inside: </span>
                <strong id="inspector-dwelling-ticks">0</strong>
              </div>
            </div>
            <div class="row">
              <label for="inspector-movement-type">Behavior</label>
              <select id="inspector-movement-type">
                <option value="socialNav">Social Nav</option>
                <option value="randomWalk">Random Walk</option>
                <option value="straightDrift">Straight Drift</option>
                <option value="seekPoint">Seek Point</option>
              </select>
            </div>
            <div class="row">
              <label for="inspector-boundary">Boundary</label>
              <select id="inspector-boundary" disabled>
                <option value="wrap">Wrap Torus</option>
                <option value="bounce">Bounded Walls</option>
              </select>
            </div>
            <p class="hint">Boundary is controlled by World Topology.</p>
            <div class="row">
              <label for="inspector-vision-enabled">Vision</label>
              <input id="inspector-vision-enabled" type="checkbox" />
            </div>
            <div class="row">
              <label for="inspector-vision-range">Vision Range</label>
              <input id="inspector-vision-range" type="number" min="0" step="1" value="120" />
            </div>
            <div class="row">
              <label for="inspector-avoid-distance">Avoid Distance</label>
              <input id="inspector-avoid-distance" type="number" min="0" step="1" value="40" />
            </div>
            <div class="row">
              <label for="inspector-hearing-skill">Hearing Skill</label>
              <input id="inspector-hearing-skill" type="number" min="0" max="1" step="0.01" value="0.5" />
            </div>
            <div class="row">
              <label for="inspector-hearing-radius">Hearing Radius</label>
              <input id="inspector-hearing-radius" type="number" min="0" step="1" value="180" />
            </div>
            <div class="row">
              <span>Nearest Heard</span>
              <strong id="inspector-heard-signature">None</strong>
            </div>
            <div class="row">
              <span>Eye (World)</span>
              <strong id="inspector-eye-world">N/A</strong>
            </div>
            <div class="row">
              <span>Eye Forward</span>
              <strong id="inspector-eye-forward">N/A</strong>
            </div>
            <div class="row">
              <label for="inspector-eye-fov">Eye FOV (°)</label>
              <input id="inspector-eye-fov" type="number" min="60" max="300" step="1" value="180" />
            </div>
            <div class="row">
              <span>Known Count</span>
              <strong id="inspector-known-count">0</strong>
            </div>
            <div class="row">
              <span>Last Felt Tick</span>
              <strong id="inspector-last-felt-tick">Never</strong>
            </div>
            <div class="row">
              <span>Known (Last 5)</span>
            </div>
            <ul id="inspector-known-list" class="rank-list"></ul>
            <div id="inspector-reproduction-row">
              <div class="row">
                <span>Fertility Enabled</span>
                <strong id="inspector-fertility-enabled">N/A</strong>
              </div>
              <div class="row">
                <span>Mature</span>
                <strong id="inspector-fertility-mature">N/A</strong>
              </div>
              <div class="row">
                <span>Pregnant</span>
                <strong id="inspector-pregnant">N/A</strong>
              </div>
              <div class="row">
                <span>Pregnancy Father</span>
                <strong id="inspector-pregnancy-father">N/A</strong>
              </div>
              <div class="row">
                <span>Pregnancy Ticks</span>
                <strong id="inspector-pregnancy-ticks">N/A</strong>
              </div>
            </div>
            <div class="row">
              <label for="inspector-feeling-enabled">Feeling Enabled</label>
              <input id="inspector-feeling-enabled" type="checkbox" checked />
            </div>
            <div class="row">
              <label for="inspector-feel-cooldown">Feel Cooldown</label>
              <input id="inspector-feel-cooldown" type="number" min="0" step="1" value="30" />
            </div>
            <div class="row">
              <label for="inspector-approach-speed">Approach Speed</label>
              <input id="inspector-approach-speed" type="number" min="0" step="0.1" value="10" />
            </div>
            <div class="row">
              <span>Feeling State</span>
              <strong id="inspector-feeling-state">idle</strong>
            </div>
            <div class="row">
              <span>Feeling Partner</span>
              <strong id="inspector-feeling-partner">None</strong>
            </div>
            <div class="row">
              <span>Feeling Ticks</span>
              <strong id="inspector-feeling-ticks">0</strong>
            </div>
            <div class="row">
              <span>Stillness Active</span>
              <strong id="inspector-stillness-active">No</strong>
            </div>
            <div class="row">
              <span>Stillness Mode</span>
              <strong id="inspector-stillness-mode">N/A</strong>
            </div>
            <div class="row">
              <span>Stillness Reason</span>
              <strong id="inspector-stillness-reason">N/A</strong>
            </div>
            <div class="row">
              <span>Stillness Ticks</span>
              <strong id="inspector-stillness-ticks">0</strong>
            </div>
            <div class="row">
              <span>Stillness RequestedBy</span>
              <strong id="inspector-stillness-requested-by">N/A</strong>
            </div>
            <div class="button-row" style="margin-top: 6px">
              <button id="inspector-introduction-btn" type="button">Request Introduction</button>
              <button id="inspector-manual-halt" type="button">Toggle Halt (manual)</button>
            </div>
            <div id="inspector-peace-cry-row">
              <div class="row">
                <label for="inspector-peace-cry-enabled">Peace-Cry</label>
                <input id="inspector-peace-cry-enabled" type="checkbox" />
              </div>
              <div class="row">
                <label for="inspector-peace-cry-cadence">Cry Cadence</label>
                <input id="inspector-peace-cry-cadence" type="number" min="1" step="1" value="20" />
              </div>
              <div class="row">
                <label for="inspector-peace-cry-radius">Cry Radius</label>
                <input id="inspector-peace-cry-radius" type="number" min="0" step="1" value="120" />
              </div>
            </div>
            <div class="row" id="inspector-speed-row">
              <label for="inspector-speed">Speed</label>
              <input id="inspector-speed" type="number" step="0.1" value="25" />
            </div>
            <div class="row" id="inspector-turn-rate-row">
              <label for="inspector-turn-rate">Turn Rate</label>
              <input id="inspector-turn-rate" type="number" step="0.1" value="2" />
            </div>
            <div id="inspector-social-row">
              <div class="row">
                <label for="inspector-decision-ticks">Decision Every Ticks</label>
                <input id="inspector-decision-ticks" type="number" min="1" step="1" value="18" />
              </div>
              <div class="row">
                <label for="inspector-intention-min-ticks">Intention Min Ticks</label>
                <input id="inspector-intention-min-ticks" type="number" min="1" step="1" value="80" />
              </div>
              <div class="row">
                <span>Current Intention</span>
                <strong id="inspector-current-intention">N/A</strong>
              </div>
              <div class="row">
                <span>Intention Ticks Left</span>
                <strong id="inspector-intention-left">N/A</strong>
              </div>
            </div>
            <div class="row" id="inspector-drift-row">
              <label for="inspector-vx">Velocity</label>
              <div class="pair-input">
                <input id="inspector-vx" type="number" step="0.1" value="0" />
                <input id="inspector-vy" type="number" step="0.1" value="0" />
              </div>
            </div>
            <div class="row" id="inspector-target-row">
              <label for="inspector-target-x">Target</label>
              <div class="pair-input">
                <input id="inspector-target-x" type="number" step="0.1" value="500" />
                <input id="inspector-target-y" type="number" step="0.1" value="350" />
              </div>
            </div>
            <div class="row" id="inspector-triangle-row">
              <span>Triangle</span>
              <div>
                <strong id="inspector-triangle-kind">N/A</strong>
                <span> | base ratio: </span>
                <strong id="inspector-triangle-base-ratio">N/A</strong>
              </div>
            </div>
            <div id="inspector-voice-row">
              <div class="row">
                <label for="inspector-voice-enabled">Voice Imposture</label>
                <input id="inspector-voice-enabled" type="checkbox" />
              </div>
              <div class="row">
                <label for="inspector-voice-signature">Claimed Voice</label>
                <select id="inspector-voice-signature">
                  <option value="Square">Square</option>
                  <option value="Pentagon">Pentagon</option>
                  <option value="HighOrder">High Order</option>
                </select>
              </div>
            </div>
            <div class="row" id="inspector-irregular-row">
              <span>Irregular</span>
              <div>
                <strong id="inspector-irregular-state">No</strong>
                <span> | deviation: </span>
                <strong id="inspector-irregular-deviation">N/A</strong>
              </div>
            </div>
            <div class="row" id="inspector-female-rank-row">
              <span>Female Rank</span>
              <strong id="inspector-female-rank">N/A</strong>
            </div>
            <div class="row" id="inspector-sway-row">
              <span>Sway</span>
              <div>
                <strong id="inspector-sway-amplitude">N/A</strong>
                <span> rad | </span>
                <strong id="inspector-sway-frequency">N/A</strong>
                <span> Hz</span>
              </div>
            </div>
            <div id="inspector-lineage-row">
              <div class="row">
                <span>Generation</span>
                <strong id="inspector-generation">0</strong>
              </div>
              <div class="row">
                <span>Dynasty</span>
                <strong id="inspector-dynasty-id">N/A</strong>
              </div>
              <div class="row">
                <span>Mother</span>
                <strong id="inspector-mother-id">Unknown</strong>
              </div>
              <div class="row">
                <span>Father</span>
                <strong id="inspector-father-id">Unknown</strong>
              </div>
              <div class="row">
                <span>Ancestors (depth 4)</span>
                <strong id="inspector-ancestors">None</strong>
              </div>
              <div class="row">
                <span>Legacy Births</span>
                <strong id="inspector-legacy-births">0</strong>
              </div>
              <div class="row">
                <span>Legacy Kills</span>
                <strong id="inspector-legacy-kills">0</strong>
              </div>
              <div class="row">
                <span>Legacy Handshakes</span>
                <strong id="inspector-legacy-handshakes">0</strong>
              </div>
              <div class="row">
                <span>Legacy Regularizations</span>
                <strong id="inspector-legacy-regularizations">0</strong>
              </div>
              <div class="row">
                <span>Living Descendants</span>
                <strong id="inspector-legacy-descendants">0</strong>
              </div>
              <div class="row">
                <span>Age (ticks)</span>
                <strong id="inspector-age">0</strong>
              </div>
              <div class="row">
                <span>Durability</span>
                <strong id="inspector-durability">N/A</strong>
              </div>
            </div>
          </div>
        </section>

        <section class="panel">
          <h2>Stats</h2>
          <div class="row"><span>Tick</span><strong id="stat-tick">0</strong></div>
          <div class="row"><span>Seed</span><strong id="stat-seed">42</strong></div>
          <div class="row"><span>Deaths This Tick</span><strong id="stat-deaths">0</strong></div>
          <div class="row"><span>Deaths (Kill, tick)</span><strong id="stat-deaths-kill-tick">0</strong></div>
          <div class="row"><span>Deaths (Attrition, tick)</span><strong id="stat-deaths-attrition-tick">0</strong></div>
          <div class="row"><span>Deaths (Kill, total)</span><strong id="stat-deaths-kill-total">0</strong></div>
          <div class="row"><span>Deaths (Attrition, total)</span><strong id="stat-deaths-attrition-total">0</strong></div>
          <div class="row"><span>Regularized This Tick</span><strong id="stat-regularized">0</strong></div>
          <div class="row"><span>Stillness Active</span><strong id="stat-stillness-active">0</strong></div>
          <div class="row"><span>Handshake Pairs Active</span><strong id="stat-handshake-active">0</strong></div>
          <div class="row"><span>Handshake Started (tick)</span><strong id="stat-handshake-started">0</strong></div>
          <div class="row"><span>Handshake Completed (tick)</span><strong id="stat-handshake-completed">0</strong></div>
          <div class="row"><span>Avg Stillness Ticks</span><strong id="stat-stillness-avg">0.0</strong></div>
          <div class="row"><span>Handshakes / 1000 ticks</span><strong id="stat-handshake-rate">0.00</strong></div>
          <div class="row"><span>Total Alive</span><strong id="stat-total">0</strong></div>
          <div class="row"><span>Births This Tick</span><strong id="stat-births-tick">0</strong></div>
          <div class="row"><span>House Door Contacts (tick)</span><strong id="stat-house-door-contacts">0</strong></div>
          <div class="row"><span>House Entries (tick)</span><strong id="stat-house-entries">0</strong></div>
          <div class="row"><span>Inside Count (tick)</span><strong id="stat-inside-tick">0</strong></div>
          <div class="row"><span>Total Inside</span><strong id="stat-total-inside">0</strong></div>
          <div class="row"><span>Seek Shelter Intent</span><strong id="stat-seek-shelter">0</strong></div>
          <div class="row"><span>Seek Home Intent</span><strong id="stat-seek-home">0</strong></div>
          <div class="row"><span>Stuck Near House</span><strong id="stat-stuck-near-house">0</strong></div>
          <div class="row"><span>Rain Active</span><strong id="stat-rain-active">0</strong></div>
          <ul id="rank-list" class="rank-list"></ul>
        </section>
      </aside>

      <main class="stage">
        <div class="world-stage">
          <canvas id="world-canvas" aria-label="Flatland simulation canvas"></canvas>
          <div id="world-hover-info" class="world-hover-info" hidden></div>
        </div>
        <section class="timeline-panel" id="flatlander-stage-panel" aria-label="Flatlander view panel">
          <h2>Flatlander View (Selected)</h2>
          <div class="flatlander-stage-controls">
            <label><input id="flatlander-grayscale" type="checkbox" checked /> Greyscale / Color</label>
            <label><input id="flatlander-include-boundaries" type="checkbox" checked /> Include Boundaries</label>
          </div>
          <canvas id="flatlander-canvas" aria-label="Flatlander retina strip"></canvas>
          <p class="hint">Select an entity to view one-dimensional sight.</p>
        </section>
        <section class="timeline-panel" aria-label="Population histogram panel">
          <h2>Population Histogram</h2>
          <div class="timeline-controls">
            <button id="population-clear-selection" type="button">Clear Selection</button>
          </div>
          <canvas id="population-histogram" aria-label="Population composition histogram"></canvas>
          <div id="population-histogram-tooltip" class="hint">Hover the chart to inspect a slice. Click to pin.</div>
        </section>
        <section class="timeline-panel" aria-label="Event timeline panel">
          <h2>Event Timeline</h2>
          <div class="timeline-controls">
            <label><input id="timeline-split-by-rank" type="checkbox" /> Split by rank/subclass</label>
            <label><input id="timeline-show-legend" type="checkbox" checked /> Show timeline legend</label>
          </div>
          <div class="timeline-controls timeline-type-controls">
            <label><input id="timeline-type-handshake-failed" type="checkbox" checked /> unsuccessful handshake</label>
            <label><input id="timeline-type-handshake" type="checkbox" checked /> handshake</label>
            <label><input id="timeline-type-house-enter" type="checkbox" checked /> enter house</label>
            <label><input id="timeline-type-house-exit" type="checkbox" checked /> exit house</label>
            <label><input id="timeline-type-death" type="checkbox" checked /> death</label>
            <label><input id="timeline-type-birth" type="checkbox" checked /> birth</label>
            <label><input id="timeline-type-regularized" type="checkbox" checked /> regularized</label>
          </div>
          <details id="timeline-rank-filters-wrap">
            <summary>Rank/Subclass Tracks</summary>
            <div class="timeline-controls timeline-rank-controls" id="timeline-rank-filters">
              <label><input data-rank-filter="Woman:Low" type="checkbox" checked /> Woman:Low</label>
              <label><input data-rank-filter="Woman:Middle" type="checkbox" checked /> Woman:Middle</label>
              <label><input data-rank-filter="Woman:High" type="checkbox" checked /> Woman:High</label>
              <label><input data-rank-filter="Triangle:Isosceles" type="checkbox" checked /> Triangle:Isosceles</label>
              <label><input data-rank-filter="Triangle:Equilateral" type="checkbox" checked /> Triangle:Equilateral</label>
              <label><input data-rank-filter="Gentleman" type="checkbox" checked /> Gentleman</label>
              <label><input data-rank-filter="Noble" type="checkbox" checked /> Noble</label>
              <label><input data-rank-filter="NearCircle" type="checkbox" checked /> NearCircle</label>
              <label><input data-rank-filter="Priest" type="checkbox" checked /> Priest</label>
              <label><input data-rank-filter="Irregular" type="checkbox" checked /> Irregular</label>
            </div>
          </details>
          <canvas id="event-timeline-canvas" aria-label="Event timeline"></canvas>
          <div id="event-timeline-legend" class="hint">
            Rain (line) / Handshake Failed / Handshake / Enter House / Exit House / Death / Birth / Regularized
          </div>
          <div id="event-timeline-tooltip" class="hint">Hover or click markers for tick details.</div>
        </section>
      </main>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
